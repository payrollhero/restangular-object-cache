var mod;mod=angular.module("restangular-object-cache",["restangular"]),mod.service("RestangularObjectCache",["Restangular",function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;i=function(a){return _.singularize(a)+"_id"},j=function(a){return _(a).pluralize()},n=function(a,b){var c,d,e,f;for(f=[],c=0,e=b.length;e>c;c++)d=b[c],f.push(a[d]);return f},c=function(){function a(a,b){this.methodName=a,this.modelName=b.modelName||a,this.modelKey=b.foreignKey,this.primaryKey=b.primaryKey||"id"}return a.prototype.fullfillRelation=function(a){var b;return b=k[this.modelName],b.allMatchingKey(this.modelKey,a[this.primaryKey])},a}(),b=function(){function a(a,b){this.methodName=a,this.modelName=b.modelName||j(this.methodName),this.modelKey=b.key||i(this.modelName),this.primaryKey=b.primaryKey||"id"}return a.prototype.fullfillRelation=function(a){var b;return b=k[this.modelName],b.firstMatchingKey(this.primaryKey,a[this.modelKey])},a}(),d=function(){function a(a,b){this.methodName=a,this.modelName=b.modelName||j(this.methodName),this.modelKey=b.foreignKey||i(this.modelName)}return a}(),f=function(){function a(a){this.modelName=a,this.definitions=[]}return a.prototype.hasMany=function(a,b){var d;return null==b&&(b={}),b.foreignKey||(b.foreignKey=i(this.modelName)),d=new c(a,b),this.definitions.push(d)},a.prototype.belongsTo=function(a,c){var d;return null==c&&(c={}),d=new b(a,c),this.definitions.push(d)},a.prototype.hasOne=function(a,b){return null==b&&(b={}),this.hasOne(a,b)},a}(),e=function(){function a(a,b){this.modelName=a,this.primaryKey=b,this.objects={},this.indexes={}}return a.prototype.addOrUpdateObject=function(a){var b,c,d,e,f;b=a[this.primaryKey],null!=b&&(this.removeObject(a),this.objects[b]=a),f=this.indexes;for(d in f)c=f[d],c[e=a[d]]||(c[e]=[]),c[a[d]].push(b)},a.prototype.removeObject=function(a){var b,c,d,e,f,g;if(b=a[this.primaryKey],e=this.objects[b]){delete this.objects[b],f=this.indexes,g=[];for(d in f)c=f[d],g.push(c[e[d]]=_(c[e[d]]||[]).without(b));return g}},a.prototype.addIndex=function(a){return this.indexes[a]={}},a.prototype.all=function(){return _(this.objects).values()},a.prototype.firstMatchingKey=function(a,b){return _.first(this.allMatchingKey(a,b))},a.prototype.allMatchingKey=function(a,b){var c,d;return a===this.primaryKey?[this.objects[b]]:_(this.indexes).has(a)?(c=this.indexes[a][b]||[],n(this.objects,c)):(d={},d[a]=b,_(this.objects).chain().values().where(d).value())},a}(),o=function(a,b){_(a.definitions).map(function(a){return b[a.methodName]=function(){return a.fullfillRelation(b)}})},p=function(a,b){var c;c=l[a],c&&o(c,b)},g=function(a,b){return k[a].addIndex(b)},h=function(a,b,c){var d;return d=new e(a,b),k[a]=d,c.extendModel(a,function(b){return d.addOrUpdateObject(b),p(a,b),b})},m=function(a){if(!k[a])throw"Not currently tracking "+a+"!  Use RestangularObjectCache.track("+a+")"},k={},l={},this.defineRelationships=function(a,b){return l[a]=new f(a),b(l[a])},this.index=function(a,b){g(a,b)},this.removeObject=function(a,b){return m(a),k[a].removeObject(b)},this.all=function(a){return m(a),k[a].all()},this.allBy=function(a,b,c){return m(a),k[a].allMatchingKey(b,c)},this.track=function(b,c){return null==c&&(c={}),c.key||(c.key="id"),c.service||(c.service=a),h(b,c.key,c.service)},this.clear=function(){return k={},l={}}}]),module.exports=mod;