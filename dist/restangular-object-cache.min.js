var mod;mod=angular.module("restangular-object-cache",["restangular"]),mod.service("RestangularObjectCache",["Restangular",function(e){var t,n,i,r,o,s,u,a,h,c,l,f,d,m;u=function(e){return _.singularize(e)+"_id"},a=function(e){return _(e).pluralize()},f=function(e,t){var n,i,r,o;for(o=[],n=0,r=t.length;r>n;n++)i=t[n],o.push(e[i]);return o},t=function(){function e(e,t){this.methodName=e,this.modelName=t.modelName||e,this.modelKey=t.foreignKey,this.primaryKey=t.primaryKey||"id"}return e.prototype.fullfillRelation=function(e){var t;return t=h[this.modelName],t.allMatchingKey(this.modelKey,e[this.primaryKey])},e}(),n=function(){function e(e,t){this.methodName=e,this.modelName=t.modelName||a(this.methodName),this.modelKey=t.key||u(this.modelName),this.primaryKey=t.primaryKey||"id"}return e.prototype.fullfillRelation=function(e){var t;return t=h[this.modelName],t.firstMatchingKey(this.primaryKey,e[this.modelKey])},e}(),r=function(){function e(e){this.modelName=e,this.definitions=[]}return e.prototype.hasMany=function(e,n){var i;return null==n&&(n={}),n.foreignKey||(n.foreignKey=u(this.modelName)),i=new t(e,n),this.definitions.push(i)},e.prototype.hasOne=function(e,t){var i;return null==t&&(t={}),i=new n(e,t),this.definitions.push(i)},e.prototype.belongsTo=function(e,t){return null==t&&(t={}),this.hasOne(e,t)},e}(),i=function(){function e(e,t){this.modelName=e,this.objects={},this.primaryKey=t,this.indexes={}}return e.prototype.addOrUpdateObject=function(e){var t,n,i,r,o;t=e[this.primaryKey],this.removeObject(e),this.objects[t]=e,o=this.indexes;for(i in o)n=o[i],n[r=e[i]]||(n[r]=[]),n[e[i]].push(t)},e.prototype.removeObject=function(e){var t,n,i,r,o,s;if(t=e[this.primaryKey],r=this.objects[t]){delete this.objects[t],o=this.indexes,s=[];for(i in o)n=o[i],s.push(n[r[i]]=_(n[r[i]]||[]).without(t));return s}},e.prototype.addIndex=function(e){return this.indexes[e]={}},e.prototype.all=function(){return _(this.objects).values()},e.prototype.firstMatchingKey=function(e,t){return _.first(this.allMatchingKey(e,t))},e.prototype.allMatchingKey=function(e,t){var n,i;return e===this.primaryKey?[this.objects[t]]:_(this.indexes).has(e)?(n=this.indexes[e][t]||[],f(this.objects,n)):(i={},i[e]=t,_(this.objects).chain().values().where(i).value())},e}(),d=function(e,t){_(e.definitions).map(function(e){return t[e.methodName]=function(){return e.fullfillRelation(t)}})},m=function(e,t){var n;n=c[e],n&&d(n,t)},o=function(e,t){return h[e].addIndex(t)},s=function(e,t,n){var r;return r=new i(e,t),h[e]=r,n.extendModel(e,function(t){return r.addOrUpdateObject(t),m(e,t),t})},l=function(e){if(!h[e])throw"Not currently tracking "+e+"!  Use RestangularObjectCache.track("+e+")"},h={},c={},this.defineRelationships=function(e,t){return c[e]=new r(e),t(c[e])},this.index=function(e,t){o(e,t)},this.removeObject=function(e,t){return l(e),h[e].removeObject(t)},this.all=function(e){return l(e),h[e].all()},this.allBy=function(e,t,n){return l(e),h[e].allMatchingKey(t,n)},this.track=function(t,n){return null==n&&(n={}),n.key||(n.key="id"),n.service||(n.service=e),s(t,n.key,n.service)},this.clear=function(){return h={},c={}}}]);