var mod;mod=angular.module("restangular-roc",["restangular"]),mod.service("RestangularObjectCache",["Restangular",function(e){var t,i,n,r,o,s,a,u,h,c,l,d,m;a=function(e){return _.singularize(e)+"_id"},u=function(e){return _(e).pluralize()},l=function(e,t){var i,n,r,o;for(o=[],i=0,r=t.length;r>i;i++)n=t[i],o.push(e[n]);return o},t=function(){function e(e,t){this.methodName=e,this.modelName=t.modelName||e,this.modelKey=t.foreignKey,this.primaryKey=t.primaryKey||"id"}return e.prototype.fullfillRelation=function(e){var t;return t=h[this.modelName],t.allMatchingKey(this.modelKey,e[this.primaryKey])},e}(),i=function(){function e(e,t){this.methodName=e,this.modelName=t.modelName||u(this.methodName),this.modelKey=t.key||a(this.modelName),this.primaryKey=t.primaryKey||"id"}return e.prototype.fullfillRelation=function(e){var t;return t=h[this.modelName],t.firstMatchingKey(this.primaryKey,e[this.modelKey])},e}(),r=function(){function e(e){this.modelName=e,this.definitions=[]}return e.prototype.hasMany=function(e,i){var n;return null==i&&(i={}),i.foreignKey||(i.foreignKey=a(this.modelName)),n=new t(e,i),this.definitions.push(n)},e.prototype.hasOne=function(e,t){var n;return null==t&&(t={}),n=new i(e,t),this.definitions.push(n)},e}(),n=function(){function e(e,t){this.modelName=e,this.objects={},this.primaryKey=t,this.indexes={}}return e.prototype.addObject=function(e){var t,i,n,r,o;console.log("Adding object to cache "+this.modelName,e),t=e[this.primaryKey],this.objects[t]=e,o=this.indexes;for(n in o)i=o[n],i[r=e[n]]||(i[r]=[]),i[e[n]].push(t)},e.prototype.removeObject=function(e){var t,i,n,r,o;console.log("Removing object from cache "+this.modelName,e),t=e[this.primaryKey],delete this.objects[t],r=this.indexes,o=[];for(n in r)i=r[n],o.push(i[e[n]]=_(i[e[n]]||[]).without(t));return o},e.prototype.addIndex=function(e){return this.indexes[e]={}},e.prototype.firstMatchingKey=function(e,t){return _.first(this.allMatchingKey(e,t))},e.prototype.allMatchingKey=function(e,t){var i,n;return e===this.primaryKey?[this.objects[t]]:_(this.indexes).has(e)?(i=this.indexes[e][t]||[],l(this.objects,i)):(n={},n[e]=t,_(this.objects).chain().values().where(n).value())},e}(),d=function(e,t){var i,n,r,o;for(o=e.definitions,n=0,r=o.length;r>n;n++)i=o[n],t[i.methodName]=function(){return i.fullfillRelation(t)}},m=function(e,t){var i;i=c[e],i&&d(i,t)},o=function(e,t){return h[e].addIndex(t)},s=function(e,t,i){var r;return r=new n(e,t),h[e]=r,i.extendModel(e,function(t){return r.addObject(t),m(e,t),t})},h={},c={},this.defineRelationships=function(e,t){return c[e]=new r(e),t(c[e])},this.index=function(e,t){o(e,t)},this.removeObject=function(e,t){return h[e].removeObject(t)},this.track=function(t,i){return null==i&&(i={}),i.key||(i.key="id"),i.service||(i.service=e),s(t,i.key,i.service)}}]);